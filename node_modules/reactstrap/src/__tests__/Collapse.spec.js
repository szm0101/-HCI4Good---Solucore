import React from 'react';
<<<<<<< HEAD
import { render, screen } from '@testing-library/react';
import '@testing-library/jest-dom';
import { Collapse } from '..';

describe('Collapse', () => {
  beforeEach(() => {
=======
import { shallow, mount } from 'enzyme';
import { Collapse } from '../';

describe('Collapse', () => {
  let isOpen;
  let wrapper;
  const toggle = () => {
    isOpen = !isOpen;
    if (wrapper != null) {
      wrapper.setProps({ isOpen });
    }
  };

  beforeEach(() => {
    isOpen = false;
>>>>>>> babce7e82dc134320378dfce834b316b88320254
    jest.useFakeTimers();
  });

  afterEach(() => {
<<<<<<< HEAD
=======
    // fast forward time for collapse to fade out
    jest.runTimersToTime(400);
>>>>>>> babce7e82dc134320378dfce834b316b88320254
    jest.clearAllTimers();
  });

  it('should render children', () => {
<<<<<<< HEAD
    render(<Collapse>Hello</Collapse>);
    expect(screen.getByText(/hello/i)).toBeInTheDocument();
  });

  it('works with strict mode', () => {
    const spy = jest.spyOn(console, 'error');
    render(
      <React.StrictMode>
        <Collapse />
      </React.StrictMode>,
    );
    expect(spy).not.toHaveBeenCalled();
  });

  it('should have default isOpen value as false', () => {
    render(<Collapse>Hello</Collapse>);
    expect(screen.getByText(/hello/i)).not.toHaveClass('show');
  });

  it('should render with class "collapse"', () => {
    render(<Collapse>Hello</Collapse>);
    expect(screen.getByText(/hello/i)).toHaveClass('collapse');
  });

  it('should render with class "collapse-horizontal" if it has prop horizontal', () => {
    render(<Collapse horizontal>Hello</Collapse>);
    expect(screen.getByText(/hello/i)).toHaveClass('collapse-horizontal');
  });

  it('should render with class "navbar-collapse" if it has prop navbar', () => {
    render(<Collapse navbar>Hello</Collapse>);
    expect(screen.getByText(/hello/i)).toHaveClass('navbar-collapse');
  });

  it('should render with class "show" when isOpen is true', () => {
    render(<Collapse isOpen>Hello</Collapse>);
    expect(screen.getByText(/hello/i)).toHaveClass('show');
  });

  it('should set height to null when isOpen is true', () => {
    render(<Collapse isOpen data-testid="collapse" />);
    expect(screen.getByTestId('collapse').style.height).toBe('');
  });

  it('should not set height when isOpen is false', () => {
    render(<Collapse isOpen={false} data-testid="collapse" />);
    expect(screen.getByTestId('collapse').style.height).toBe('');
  });

  it('should forward all styles', () => {
    render(
      <Collapse
        isOpen={false}
        data-testid="collapse"
        style={{ backgroundColor: 'black' }}
      />,
    );
    expect(screen.getByTestId('collapse').style.backgroundColor).toBe('black');
=======
    wrapper = mount(<Collapse><p>hello</p></Collapse>);
    expect(wrapper.find('p').text()).toBe('hello');
  });

  it('should have default isOpen value', () => {
    wrapper = shallow(<Collapse />);
    expect(wrapper.instance().props.isOpen).toEqual(false);
  });

  it('should render with class "collapse"', () => {
    wrapper = mount(<Collapse />);
    expect(wrapper.find('div').hasClass('collapse')).toEqual(true);
  });

  it('should render with class "navbar-collapse" if it has prop navbar', () => {
    wrapper = mount(<Collapse navbar />);
    expect(wrapper.find('div').hasClass('navbar-collapse')).toEqual(true);
  });

  it('should render with class "show" when isOpen is true', () => {
    wrapper = mount(<Collapse isOpen />);
    expect(wrapper.find('div').hasClass('show')).toEqual(true);
  });

  it('should set height to null when isOpen is true', () => {
    wrapper = shallow(<Collapse isOpen />);
    expect(wrapper.state('height')).toBe(null);
  });

  it('should not set height when isOpen is false', () => {
    wrapper = shallow(<Collapse isOpen={false} />);
    expect(wrapper.state('height')).toBe(null);
  });

  it('should forward all styles', () => {
    wrapper = mount(<Collapse isOpen style={{ backgroundColor: 'black' }} />);
    expect(wrapper.find('div').prop('style').backgroundColor).toBe('black');
>>>>>>> babce7e82dc134320378dfce834b316b88320254
  });

  it('should forward all callbacks', () => {
    const callbacks = {
      onEnter: jest.fn(),
      onEntering: jest.fn(),
      onEntered: jest.fn(),
      onExit: jest.fn(),
      onExiting: jest.fn(),
      onExited: jest.fn(),
    };
<<<<<<< HEAD
    const { rerender } = render(<Collapse isOpen={false} {...callbacks} />);
    rerender(<Collapse isOpen {...callbacks} />);
    expect(callbacks.onEnter).toHaveBeenCalled();
    expect(callbacks.onEntering).toHaveBeenCalled();
    expect(callbacks.onEntered).not.toHaveBeenCalled();
    jest.advanceTimersByTime(350);
    expect(callbacks.onEntered).toHaveBeenCalled();
    expect(callbacks.onExit).not.toHaveBeenCalled();
    rerender(<Collapse isOpen={false} {...callbacks} />);
    expect(callbacks.onExit).toHaveBeenCalled();
    expect(callbacks.onExiting).toHaveBeenCalled();
    expect(callbacks.onExited).not.toHaveBeenCalled();
    jest.advanceTimersByTime(350);
    expect(callbacks.onExiting).toHaveBeenCalled();
    expect(callbacks.onExited).toHaveBeenCalled();
  });

  it('should apply correct bootstrap classes', () => {
    const { rerender } = render(
      <Collapse isOpen={false} data-testid="collapse" />,
    );
    rerender(<Collapse isOpen data-testid="collapse" />);
    expect(screen.getByTestId('collapse')).toHaveClass('collapsing');
    jest.advanceTimersByTime(350);
    expect(screen.getByTestId('collapse')).toHaveClass('collapse show');

    rerender(<Collapse isOpen={false} data-testid="collapse" />);
    expect(screen.getByTestId('collapse')).toHaveClass('collapsing');
    jest.advanceTimersByTime(350);
    expect(screen.getByTestId('collapse')).toHaveClass('collapse');
  });

  it('should set inline style to 0 when isOpen change to false and remove after transition', () => {
    const { rerender } = render(<Collapse isOpen data-testid="collapse" />);
    rerender(<Collapse isOpen={false} data-testid="collapse" />);
    expect(screen.getByTestId('collapse').style.height).toBe('0px');
    jest.advanceTimersByTime(380);
    expect(screen.getByTestId('collapse').style.height).toBe('');
=======
    wrapper = mount(<Collapse isOpen={isOpen} {...callbacks} />);
    toggle();
    expect(callbacks.onEnter).toHaveBeenCalled();
    expect(callbacks.onEntering).toHaveBeenCalled();
    expect(callbacks.onEntered).not.toHaveBeenCalled();
    jest.runTimersToTime(350);
    expect(callbacks.onEntered).toHaveBeenCalled();
    expect(callbacks.onExit).not.toHaveBeenCalled();

    toggle();
    expect(callbacks.onExit).toHaveBeenCalled();
    expect(callbacks.onExiting).toHaveBeenCalled();
    expect(callbacks.onExited).not.toHaveBeenCalled();
    jest.runTimersToTime(350);
    expect(callbacks.onExiting).toHaveBeenCalled();
    expect(callbacks.onExited).toHaveBeenCalled();

    wrapper.unmount();
  });

  it('should apply correct bootstrap classes', () => {
    wrapper = mount(<Collapse isOpen={isOpen} />);
    toggle();
    expect(wrapper.update().find('div').prop('className')).toBe('collapsing');
    jest.runTimersToTime(350);
    expect(wrapper.update().find('div').prop('className')).toBe('collapse show');

    toggle();
    expect(wrapper.update().find('div').prop('className')).toBe('collapsing');
    jest.runTimersToTime(350);
    expect(wrapper.update().find('div').prop('className')).toBe('collapse');

    wrapper.unmount();
  });

  it('should set inline style to 0 when isOpen change to false', () => {
    isOpen = true;
    wrapper = mount(<Collapse isOpen={isOpen} />);
    toggle();
    expect(wrapper.state('height')).toBe(0);
    wrapper.unmount();
  });

  it('should remove inline style when isOpen change to true after transition', () => {
    wrapper = mount(<Collapse isOpen={isOpen} />);
    toggle();
    jest.runTimersToTime(380);
    expect(wrapper.state('height')).toBe(null);
    wrapper.unmount();
>>>>>>> babce7e82dc134320378dfce834b316b88320254
  });
});
