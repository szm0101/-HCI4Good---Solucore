import React from 'react';
import PropTypes from 'prop-types';
import ReactDOM from 'react-dom';
import classNames from 'classnames';
import { Popper } from 'react-popper';
import { DropdownContext } from './DropdownContext';
<<<<<<< HEAD
import {
  mapToCssModules,
  tagPropType,
  targetPropType,
  getTarget,
  deprecated,
} from './utils';
=======
import { mapToCssModules, tagPropType, targetPropType, getTarget } from './utils';
>>>>>>> babce7e82dc134320378dfce834b316b88320254

const propTypes = {
  tag: tagPropType,
  children: PropTypes.node.isRequired,
<<<<<<< HEAD
  dark: PropTypes.bool,
  end: PropTypes.bool,
  /** Flips the menu to the opposite side if there is not enough space to fit */
  flip: PropTypes.bool,
  modifiers: PropTypes.array,
  className: PropTypes.string,
  cssModule: PropTypes.object,
  style: PropTypes.object,
  persist: PropTypes.bool,
  strategy: PropTypes.string,
  container: targetPropType,
  /** Update popper layout when a click event comes up. This leverages event bubbling. */
  updateOnSelect: PropTypes.bool,
  right: deprecated(PropTypes.bool, 'Please use "end" instead.'),
};

=======
  right: PropTypes.bool,
  flip: PropTypes.bool,
  modifiers: PropTypes.object,
  className: PropTypes.string,
  cssModule: PropTypes.object,
  persist: PropTypes.bool,
  positionFixed: PropTypes.bool,
  container: targetPropType,
};

const defaultProps = {
  tag: 'div',
  flip: true,
};

const noFlipModifier = { flip: { enabled: false } };

>>>>>>> babce7e82dc134320378dfce834b316b88320254
const directionPositionMap = {
  up: 'top',
  left: 'left',
  right: 'right',
<<<<<<< HEAD
  start: 'left',
  end: 'right',
=======
>>>>>>> babce7e82dc134320378dfce834b316b88320254
  down: 'bottom',
};

class DropdownMenu extends React.Component {
<<<<<<< HEAD
  getRole() {
    if (this.context.menuRole === 'listbox') {
      return 'listbox';
    }
    return 'menu';
=======

  getRole() {
    if(this.context.menuRole === 'listbox') {
      return 'listbox'
    }
    return 'menu'
>>>>>>> babce7e82dc134320378dfce834b316b88320254
  }

  render() {
    const {
      className,
      cssModule,
<<<<<<< HEAD
      dark,
      end,
      right,
      tag = 'div',
      flip = true,
      modifiers = [],
      persist,
      strategy,
      container,
      updateOnSelect,
      ...attrs
    } = this.props;

    const classes = mapToCssModules(
      classNames(className, 'dropdown-menu', {
        'dropdown-menu-dark': dark,
        'dropdown-menu-end': end || right,
        show: this.context.isOpen,
      }),
      cssModule,
    );
=======
      right,
      tag,
      flip,
      modifiers,
      persist,
      positionFixed,
      container,
      ...attrs
    } = this.props;

    const classes = mapToCssModules(classNames(
      className,
      'dropdown-menu',
      {
        'dropdown-menu-right': right,
        show: this.context.isOpen,
      }
    ), cssModule);
>>>>>>> babce7e82dc134320378dfce834b316b88320254

    const Tag = tag;

    if (persist || (this.context.isOpen && !this.context.inNavbar)) {
<<<<<<< HEAD
      const position1 =
        directionPositionMap[this.context.direction] || 'bottom';
      const position2 = end || right ? 'end' : 'start';
      const poperPlacement = `${position1}-${position2}`;
      const poperModifiers = [
        ...modifiers,
        {
          name: 'flip',
          enabled: !!flip,
        },
      ];
=======

      const position1 = directionPositionMap[this.context.direction] || 'bottom';
      const position2 = right ? 'end' : 'start';
      const poperPlacement = `${position1}-${position2}`;
      const poperModifiers = !flip ? {
        ...modifiers,
        ...noFlipModifier,
      } : modifiers;
      const popperPositionFixed = !!positionFixed;
>>>>>>> babce7e82dc134320378dfce834b316b88320254

      const popper = (
        <Popper
          placement={poperPlacement}
          modifiers={poperModifiers}
<<<<<<< HEAD
          strategy={strategy}
        >
          {({ ref, style, placement, update }) => {
=======
          positionFixed={popperPositionFixed}
        >
          {({ ref, style, placement }) => {
>>>>>>> babce7e82dc134320378dfce834b316b88320254
            let combinedStyle = { ...this.props.style, ...style };

            const handleRef = (tagRef) => {
              // Send the ref to `react-popper`
              ref(tagRef);
              // Send the ref to the parent Dropdown so that clicks outside
              // it will cause it to close
              const { onMenuRef } = this.context;
              if (onMenuRef) onMenuRef(tagRef);
            };

            return (
              <Tag
                tabIndex="-1"
                role={this.getRole()}
                ref={handleRef}
                {...attrs}
                style={combinedStyle}
                aria-hidden={!this.context.isOpen}
                className={classes}
<<<<<<< HEAD
                data-popper-placement={placement}
                onClick={() => updateOnSelect && update()}
=======
                x-placement={placement}
>>>>>>> babce7e82dc134320378dfce834b316b88320254
              />
            );
          }}
        </Popper>
      );

      if (container) {
        return ReactDOM.createPortal(popper, getTarget(container));
<<<<<<< HEAD
      }
      return popper;
    }
    const { onMenuRef } = this.context;
=======
      } else {
        return popper;
      }
    }
>>>>>>> babce7e82dc134320378dfce834b316b88320254

    return (
      <Tag
        tabIndex="-1"
        role={this.getRole()}
        {...attrs}
<<<<<<< HEAD
        ref={onMenuRef}
        aria-hidden={!this.context.isOpen}
        className={classes}
        data-popper-placement={attrs.placement}
      />
    );
  }
}

DropdownMenu.propTypes = propTypes;
=======
        aria-hidden={!this.context.isOpen}
        className={classes}
        x-placement={attrs.placement}
      />
    );
  }
};

DropdownMenu.propTypes = propTypes;
DropdownMenu.defaultProps = defaultProps;
>>>>>>> babce7e82dc134320378dfce834b316b88320254
DropdownMenu.contextType = DropdownContext;

export default DropdownMenu;
